<div class="row">
	<div class="col-lg-12">
		<div class="panel panel-default">
			<div class="panel-body text-center">
				<h2 class="no-margin-top col-xs-space-bottom"><i class="fa fa-share-alt"></i>Link da Agenda do Dia Atual</h2>
				<div class="col-xs-space-bottom">
					<a target="_blank" id="aLink" href="#" class="btn btn-outline btn-primary" style="word-break: break-all;"></a>
				</div>
				<button type="button" id="btnLink" class="btn btn-primary btn-copyjs"><i class="fa fa-copy"></i>Copiar</button>
			</div>
		</div>
	</div>
</div>
<div class="container-fluid">
	<div class="row">
		<div class="col-sm-5">
			<div class="form-group">
				<label for="turma">Filtrar por Turma</label>
				<select size="1" id="turma" class="form-control">
					<option value="0">Todas</option>
					<% for (let i = 0; i < turmas.length; i++) { %>
						<option value="<%- turmas[i].id_turma %>"><%= turmas[i].desc_turma %></option>
					<% } %>
				</select>
			</div>
		</div>
	</div>
</div>
	
<div class="row">
	<div class="col-lg-12">
		<div class="panel panel-default">
			<div class="panel-body text-center">
				<h2 class="no-margin-top col-xs-space-bottom"><i class="fa fa-calendar"></i>Resumo de Hoje</h2>

				<div id="calendario"></div>
			</div>
		</div>
	</div>
</div>

<form id="formUpload">
	<input type="file" accept=".csv" id="arquivoCSV" name="arquivoCSV"  />
	<input type="submit" value="Importar" />
</form>

<%- contentFor("scripts") %>
<script type="text/javascript">
	"use strict";


	var url = location.href, i = url.lastIndexOf("/"), aLink = document.getElementById("aLink");
	url += ((i !== (url.length - 1)) ? "/hoje" : "hoje");
	document.getElementById("btnLink").setAttribute("data-clipboard-text", url);
	aLink.setAttribute("href", url);
	aLink.textContent = url.substr(url.indexOf("://") + 3);
	prepareCopyHandler();

	var eventos = <%- JSON.stringify(lista) %>;

	converterEventos(eventos);

	var opcoesCalendario = {
		headerToolbar: {
			left: "",
			center: "title",
			right: ""
		},
		initialDate: "<%= hoje %>",
		initialView: "dayGridMonth",
		locale: "pt-br",
		buttonIcons: false,
		weekNumbers: false,
		navLinks: false,
		editable: false,
		dayMaxEvents: true,
		events: eventos
	};

	var calendario = new FullCalendar.Calendar(document.getElementById("calendario"), opcoesCalendario);

	calendario.render();
	
	console.log(eventos);

</script>

<script type="text/javascript">

	$("#formUpload").validate({
		
		rules: {
			
			arquivoCSV: {
				required: true
			}
			
		},
		
		submitHandler: function (form) {

			if ($.active) {
				return;
			}
			
			let opcoes = {
				
				url: "<%- root %>/evento/importar",
				
				// Não precisa do cache para POST e PUT!
				method: "POST",
				
				// Só com campos de texto/data/número
				//data: $("#formCriar").serialize(),

				// Geral (incluindo um ou mais arquivos)
				data: new FormData(form),
				processData: false,
				contentType: false,

				success: function (dadosDeRetorno) {
					alert("Sucesso! " + dadosDeRetorno);
				},
				
				error: function () {
					alert("Deu ruim! :(");
				}
				
			};
			
			$.ajax(opcoes);
		}
		
	});
</script>
